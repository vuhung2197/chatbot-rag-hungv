# ğŸ° Káº¿ Hoáº¡ch Dá»± Ãn: Cyber Slots (Ná»• HÅ©)

## 1. ğŸŒŸ KhÃ¡i Niá»‡m & Tá»•ng Quan
**TÃªn Game**: Cyber Slots 2077 (hoáº·c "Kho BÃ¡u AI")
**Chá»§ Äá»**: Cyberpunk / Neon / AI TÆ°Æ¡ng lai. Ná»n tá»‘i vá»›i cÃ¡c biá»ƒu tÆ°á»£ng neon rá»±c rá»¡.
**CÆ¡ Cháº¿ ChÃ­nh**: Video Slot 5 Guá»“ng, 3 HÃ ng (5x3).
**Äiá»ƒm Nháº¥n Äáº·c Biá»‡t**: **Progressive Jackpot (Ná»• HÅ© LÅ©y Tiáº¿n)** - Má»™t quá»¹ thÆ°á»Ÿng chung tÄƒng lÃªn theo má»—i lÆ°á»£t Ä‘áº·t cÆ°á»£c trÃªn toÃ n há»‡ thá»‘ng cho Ä‘áº¿n khi má»™t ngÆ°á»i chÆ¡i may máº¯n trÃºng "Giáº£i Äáº·c Biá»‡t".

---

## 2. âš™ï¸ CÆ¡ Cháº¿ Game

### 2.1. Guá»“ng Quay (Cáº¥u TrÃºc)
- **LÆ°á»›i**: 5 Cá»™t (Guá»“ng) x 3 HÃ ng.
- **DÃ²ng Tráº£ ThÆ°á»Ÿng (Paylines)**: 20 dÃ²ng cá»‘ Ä‘á»‹nh (CÃ¡c Ä‘Æ°á»ng Ä‘Æ°á»£c tÃ­nh lÃ  "Tháº¯ng" náº¿u cÃ¡c biá»ƒu tÆ°á»£ng trÃ¹ng khá»›p).
  - *VÃ­ dá»¥*: ÄÆ°á»ng tháº³ng ngang, hÃ¬nh chá»¯ V, Ä‘Æ°á»ng ZÃ­c-záº¯c.

### 2.2. Biá»ƒu TÆ°á»£ng & Tráº£ ThÆ°á»Ÿng (CÃ³ Trá»ng Sá»‘)
Má»—i biá»ƒu tÆ°á»£ng cÃ³ má»™t "trá»ng sá»‘" (xÃ¡c suáº¥t xuáº¥t hiá»‡n).
| Biá»ƒu TÆ°á»£ng | Loáº¡i | MÃ´ Táº£ | Tráº£ ThÆ°á»Ÿng (3/4/5 liÃªn tiáº¿p) | Trá»ng Sá»‘ (Äá»™ Hiáº¿m) |
|:---|:---|:---|:---|:---|
| **ğŸ’ DIAMOND** | **JACKPOT** | KÃ­ch hoáº¡t Giáº£i Äáº·c Biá»‡t náº¿u 5x trÃªn má»™t dÃ²ng | x500 (hoáº·c Ná»• HÅ©) | Ráº¥t Hiáº¿m (0.1%) |
| **ğŸ¤– WILD** | **WILD** | Thay tháº¿ cho má»i biá»ƒu tÆ°á»£ng trá»« Diamond | - | Hiáº¿m (2%) |
| **7ï¸âƒ£ SEVEN** | Cao | Sá»‘ 7 May Máº¯n Cá»• Äiá»ƒn (Kiá»ƒu Neon) | x10 / x50 / x200 | Tháº¥p (5%) |
| **ğŸ“€ DISK** | Trung BÃ¬nh | ÄÄ©a Má»m VÃ ng | x5 / x20 / x80 | Trung BÃ¬nh (15%) |
| **ğŸ’ CHERRY** | Tháº¥p | Cherry Ká»¹ Thuáº­t Sá»‘ | x2 / x5 / x20 | Cao (30%) |
| **ğŸ…°ï¸ A / K / Q**| Tháº¥p | CÃ¡c Chá»¯ CÃ¡i | x1 / x3 / x10 | Cao (48%) |

*LÆ°u Ã½: CÃ¡c trá»ng sá»‘ quyáº¿t Ä‘á»‹nh logic `Sinh Ma Tráº­n` á»Ÿ backend.*

### 2.3. Logic Ná»• HÅ© LÅ©y Tiáº¿n
1.  **ÄÃ³ng GÃ³p**: Má»—i lÆ°á»£t quay trÃ­ch **1%** Sá»‘ Tiá»n CÆ°á»£c vÃ  cá»™ng vÃ o Quá»¹ Jackpot Chung trong cÆ¡ sá»Ÿ dá»¯ liá»‡u.
2.  **KÃ­ch Hoáº¡t**: Náº¿u ngÆ°á»i chÆ¡i quay Ä‘Æ°á»£c **5 DIAMONDS** trÃªn DÃ²ng Tráº£ ThÆ°á»Ÿng #1 (HÃ ng Giá»¯a), há» tháº¯ng 100% Quá»¹ Jackpot.
3.  **Äáº·t Láº¡i**: Sau khi Ä‘Æ°á»£c trÃºng, quá»¹ sáº½ Ä‘áº·t láº¡i vá» "Sá»‘ Tiá»n Khá»Ÿi Táº¡o" (vÃ­ dá»¥: 1,000,000 hoáº·c má»©c cÆ¡ báº£n tÆ°Æ¡ng Ä‘Æ°Æ¡ng VND).

---

## 3. ğŸ—ï¸ Kiáº¿n TrÃºc Ká»¹ Thuáº­t

### 3.1. SÆ¡ Äá»“ CÆ¡ Sá»Ÿ Dá»¯ Liá»‡u (PostgreSQL)

**Báº£ng: `jackpot_pools`**
| Cá»™t | Kiá»ƒu | MÃ´ Táº£ |
|:---|:---|:---|
| `id` | SERIAL | KhÃ³a ChÃ­nh (PK) |
| `game_type` | VARCHAR | 'SLOTS_CYBER' |
| `current_amount`| NUMERIC | Sá»‘ tiá»n hiá»‡n táº¡i trong hÅ©. |
| `updated_at` | TIMESTAMP | Thá»i gian cáº­p nháº­t láº§n cuá»‘i. |

**Báº£ng: `game_slots_sessions`**
(LÆ°u trá»¯ má»i lÆ°á»£t quay cho lá»‹ch sá»­ & tÃ­nh minh báº¡ch)
| Cá»™t | Kiá»ƒu | MÃ´ Táº£ |
|:---|:---|:---|
| `id` | UUID | KhÃ³a ChÃ­nh (PK) |
| `user_id` | INT | ID NgÆ°á»i ChÆ¡i |
| `bet_amount` | NUMERIC | Tá»•ng cÆ°á»£c |
| `matrix` | JSONB | Káº¿t Quáº£ 5x3 `[['A','K','A'],...]` |
| `win_amount` | NUMERIC | Tá»•ng Tiá»n Tháº¯ng |
| `is_jackpot` | BOOLEAN | LÆ°á»£t quay nÃ y cÃ³ ná»• hÅ© khÃ´ng? |
| `nonce` | BIGINT | DÃ¹ng cho Provably Fair |

### 3.2. Logic Backend (Provably Fair)
Káº¿t quáº£ quay lÃ  **xÃ¡c Ä‘á»‹nh trÆ°á»›c** dá»±a trÃªn cÃ¡c háº¡t giá»‘ng (seeds).
- **Thuáº­t ToÃ¡n**: `HMAC-SHA256(ServerSeed, ClientSeed, Nonce)` -> Hash Káº¿t Quáº£.
- **Sinh Ma Tráº­n**:
  - Chia Hash thÃ nh 15 Ä‘oáº¡n (5 cá»™t * 3 hÃ ng).
  - Chuyá»ƒn Ä‘á»•i má»—i Ä‘oáº¡n thÃ nh má»™t sá»‘ (0-9999).
  - Ãnh xáº¡ sá»‘ Ä‘Ã³ sang Biá»ƒu TÆ°á»£ng dá»±a trÃªn Dáº£i Trá»ng Sá»‘.
  - *VÃ­ dá»¥*: 0-10 -> Diamond; 11-500 -> Wild; v.v.

### 3.3. CÃ¡c Endpoint API
- `GET /games/slots/jackpot`: Tráº£ vá» `{ poolAmount: 1250000.50 }` (Frontend gá»i má»—i 5s).
- `POST /games/slots/spin`:
  - Äáº§u vÃ o: `{ betAmount: 10000 }`
  - Logic: Kiá»ƒm tra Sá»‘ DÆ° -> Trá»« Sá»‘ DÆ° -> Cá»™ng 1% vÃ o HÅ© -> Sinh Ma Tráº­n -> TÃ­nh Tiá»n Tháº¯ng -> Cáº­p Nháº­t Sá»‘ DÆ° -> Tráº£ Vá» Káº¿t Quáº£.
  - Äáº§u ra: `{ matrix: [...], winLines: [...], totalWin: 50000, jackpotShare: 0 }`.

---

## 4. ğŸ¨ Triá»ƒn Khai Frontend (React)

### 4.1. CÃ¡c ThÃ nh Pháº§n Giao Diá»‡n
- **SlotReel**: Dáº£i biá»ƒu tÆ°á»£ng dá»c.
  - *Hoáº¡t áº¢nh*: CSS `translateY` vá»›i `transition-timing-function: cubic-bezier` Ä‘á»ƒ mÃ´ phá»ng "quay lÃªn, xuá»‘ng nhanh, dá»«ng náº£y".
  - *LÃ m Má»*: Ãp dá»¥ng `filter: blur(4px)` trong khi chuyá»ƒn Ä‘á»™ng Ä‘á»ƒ tÄƒng tÃ­nh chÃ¢n thá»±c.
- **JackpotTicker**: Bá»™ Ä‘áº¿m sá»‘ hoáº¡t hÃ¬nh (kiá»ƒu Odometer) hiá»ƒn thá»‹ hÅ© Ä‘ang tÄƒng á»Ÿ trÃªn cÃ¹ng.
- **ControlPanel**: Chá»n Má»©c CÆ°á»£c (Thanh trÆ°á»£t/NÃºt), NÃºt Quay (To, PhÃ¡t sÃ¡ng), CÃ´ng táº¯c Quay Tá»± Äá»™ng.

### 4.2. Quáº£n LÃ½ Tráº¡ng ThÃ¡i (State Management)
- `isSpinning`: KhÃ³a cÃ¡c Ä‘iá»u khiá»ƒn.
- `matrix`: CÃ¡c biá»ƒu tÆ°á»£ng Ä‘ang hiá»ƒn thá»‹ hiá»‡n táº¡i.
- `winDetails`: Nhá»¯ng dÃ²ng nÃ o tháº¯ng (Ä‘á»ƒ váº½ Ä‘Æ°á»ng ná»‘i trÃªn lÆ°á»›i).

---

## 5. ğŸ“… CÃ¡c Giai Äoáº¡n Thá»±c Hiá»‡n

- [x] **Giai Äoáº¡n 1: CÆ¡ Sá»Ÿ Dá»¯ Liá»‡u & Backend Core**
    - Táº¡o schema SQL cho jackpot vÃ  sessions.
    - Triá»ƒn khai logic `SlotsController.spin` vá»›i toÃ¡n há»c Ngáº«u NhiÃªn CÃ³ Trá»ng Sá»‘.
    - Triá»ƒn khai logic háº¡t giá»‘ng Provably Fair cho Slots.

- [x] **Giai Äoáº¡n 2: Giao Diá»‡n Frontend CÆ¡ Báº£n**
    - Táº¡o `SlotsGame.js`.
    - XÃ¢y dá»±ng Layout LÆ°á»›i 5x3.
    - Triá»ƒn khai hiá»ƒn thá»‹ biá»ƒu tÆ°á»£ng cÆ¡ báº£n (Chá»§ Ä‘á» Cyber).

- [ ] **Giai Äoáº¡n 3: Hoáº¡t áº¢nh & Trau Chuá»‘t**
    - ThÃªm logic hoáº¡t áº£nh Quay Guá»“ng.
    - ThÃªm váº½ DÃ²ng Tháº¯ng (SVG overlay).
    - ThÃªm Hiá»‡u á»¨ng Ã‚m Thanh (Tiáº¿ng quay, chuÃ´ng tháº¯ng, cÃ²i bÃ¡o Ä‘á»™ng Jackpot).

- [ ] **Giai Äoáº¡n 4: TÃ­ch Há»£p**
    - Káº¿t ná»‘i Frontend vá»›i API `/spin`.
    - Káº¿t ná»‘i Jackpot Ticker trá»±c tiáº¿p.
    - Kiá»ƒm tra cáº­p nháº­t sá»‘ dÆ° vÃ  Lá»‹ch Sá»­.
