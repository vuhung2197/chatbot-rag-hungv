# âœï¸ Writing Practice Tab - Ã TÆ°á»Ÿng & Workflow

**NgÃ y táº¡o:** 2026-02-26  
**PhiÃªn báº£n:** 1.0  
**Thuá»™c:** PILLAR 2 - EdTech Features  

---

## ğŸ“‹ Tá»•ng Quan

XÃ¢y dá»±ng má»™t tab **"Writing Practice"** riÃªng biá»‡t trong app, cho phÃ©p ngÆ°á»i dÃ¹ng luyá»‡n viáº¿t tiáº¿ng Anh theo **cáº¥p Ä‘á»™ tÄƒng dáº§n** (CEFR A1â†’C2), cÃ³ **AI cháº¥m bÃ i real-time**, lÆ°u **streak** vÃ  **tá»« má»›i** Ä‘á»ƒ theo dÃµi tiáº¿n bá»™.

---

## ğŸ¯ Core Features

### 1. Há»‡ Thá»‘ng Cáº¥p Äá»™ (6 Levels - CEFR)

| Level | TÃªn | Dáº¡ng BÃ i | Giá»›i Háº¡n Tá»« | VÃ­ Dá»¥ |
|-------|-----|----------|-------------|-------|
| **A1** | Beginner | Viáº¿t cÃ¢u Ä‘Æ¡n, Ä‘iá»n tá»« | 10-30 tá»« | "Describe your family" |
| **A2** | Elementary | Viáº¿t Ä‘oáº¡n ngáº¯n, email | 30-60 tá»« | "Write a short email to a friend" |
| **B1** | Intermediate | Viáº¿t paragraph, thÆ° | 80-150 tá»« | "Write about your last holiday" |
| **B2** | Upper-Inter | Essay ngáº¯n, review | 150-250 tá»« | "Write a movie review" |
| **C1** | Advanced | Essay, report | 250-400 tá»« | "Discuss pros and cons of remote work" |
| **C2** | Mastery | Academic essay | 400+ tá»« | "Analyze the impact of AI on education" |

### 2. Loáº¡i BÃ i Táº­p

```
ğŸ“ WRITING EXERCISE TYPES
â”œâ”€â”€ ğŸ”¤ Sentence Building    (A1-A2) - Sáº¯p xáº¿p / HoÃ n thÃ nh cÃ¢u
â”œâ”€â”€ ğŸ“§ Email/Letter         (A2-B1) - Viáº¿t email theo tÃ¬nh huá»‘ng
â”œâ”€â”€ ğŸ“– Story Continuation   (B1-B2) - Viáº¿t tiáº¿p cÃ¢u chuyá»‡n
â”œâ”€â”€ ğŸ’¬ Opinion Writing      (B1-C1) - BÃ y tá» quan Ä‘iá»ƒm
â”œâ”€â”€ ğŸ“Š Report/Summary       (B2-C1) - TÃ³m táº¯t / BÃ¡o cÃ¡o
â””â”€â”€ ğŸ“š Academic Essay       (C1-C2) - Luáº­n vÄƒn há»c thuáº­t
```

### 3. AI Feedback System

AI sáº½ cháº¥m bÃ i theo **4 tiÃªu chÃ­** (giá»‘ng IELTS Writing):

| TiÃªu ChÃ­ | Trá»ng Sá»‘ | Ná»™i Dung |
|-----------|----------|----------|
| **Grammar** | 30% | Lá»—i ngá»¯ phÃ¡p, cáº¥u trÃºc cÃ¢u |
| **Vocabulary** | 25% | Phong phÃº tá»« vá»±ng, dÃ¹ng tá»« Ä‘Ãºng |
| **Coherence** | 25% | Máº¡ch láº¡c, logic, liÃªn káº¿t |
| **Task Response** | 20% | Tráº£ lá»i Ä‘Ãºng yÃªu cáº§u Ä‘á» bÃ i |

**Output cá»§a AI:**
- âœ… Äiá»ƒm tá»•ng (0-100) + Ä‘iá»ƒm tá»«ng tiÃªu chÃ­
- ğŸ”´ Highlight lá»—i sai trá»±c tiáº¿p trong bÃ i viáº¿t
- ğŸ’¡ Gá»£i Ã½ sá»­a cá»¥ thá»ƒ cho tá»«ng lá»—i
- ğŸ“ Báº£n viáº¿t láº¡i máº«u (Model Answer)
- ğŸ†• Danh sÃ¡ch tá»« má»›i gá»£i Ã½ thÃªm vÃ o vocabulary

### 4. Streak System

```
ğŸ”¥ STREAK TRACKING
â”œâ”€â”€ Daily Streak: Viáº¿t Ã­t nháº¥t 1 bÃ i/ngÃ y
â”œâ”€â”€ Streak Milestones:
â”‚   â”œâ”€â”€ ğŸ¥‰  7 ngÃ y  â†’ Badge "Week Warrior"
â”‚   â”œâ”€â”€ ğŸ¥ˆ 30 ngÃ y  â†’ Badge "Monthly Master" 
â”‚   â”œâ”€â”€ ğŸ¥‡ 100 ngÃ y â†’ Badge "Century Writer"
â”‚   â””â”€â”€ ğŸ’ 365 ngÃ y â†’ Badge "Writing Legend"
â”œâ”€â”€ Streak Freeze: 1 láº§n/tuáº§n (Premium: 3 láº§n)
â””â”€â”€ Streak Recovery: DÃ¹ng XP Ä‘á»ƒ khÃ´i phá»¥c (trong 24h)
```

### 5. Vocabulary Tracker

- **Auto-collect**: AI tá»± Ä‘á»™ng gom tá»« má»›i tá»« bÃ i viáº¿t + gá»£i Ã½
- **Manual add**: User thÃªm tá»« báº¥t ká»³
- **Má»—i tá»« lÆ°u**: word, definition, example sentence, level, ngÃ y há»c
- **SRS Review**: Ã”n táº­p theo Spaced Repetition (SM-2)
- **Stats**: Tá»•ng tá»« Ä‘Ã£ há»c, tá»« Ä‘Ã£ master, tá»« cáº§n Ã´n

---

## ğŸ—„ï¸ Database Schema

```sql
-- 1. Writing Exercises (NgÃ¢n hÃ ng Ä‘á» bÃ i)
CREATE TABLE writing_exercises (
    id SERIAL PRIMARY KEY,
    level VARCHAR(2) NOT NULL CHECK (level IN ('A1','A2','B1','B2','C1','C2')),
    type VARCHAR(50) NOT NULL, -- 'sentence','email','story','opinion','report','essay'
    title VARCHAR(255) NOT NULL,
    prompt TEXT NOT NULL,          -- Äá» bÃ i
    hints JSONB,                   -- Gá»£i Ã½, tá»« khÃ³a
    min_words INT DEFAULT 10,
    max_words INT DEFAULT 500,
    sample_answer TEXT,            -- BÃ i máº«u (optional)
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. User Writing Submissions (BÃ i ná»™p)
CREATE TABLE writing_submissions (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    exercise_id INT REFERENCES writing_exercises(id),
    content TEXT NOT NULL,          -- BÃ i viáº¿t cá»§a user
    word_count INT NOT NULL,
    -- AI Scores
    score_total DECIMAL(5,2),       -- 0-100
    score_grammar DECIMAL(5,2),
    score_vocabulary DECIMAL(5,2),
    score_coherence DECIMAL(5,2),
    score_task DECIMAL(5,2),
    -- AI Feedback
    feedback JSONB,                 -- {errors: [], suggestions: [], model_answer: ""}
    new_words JSONB,                -- ["word1", "word2"] - tá»« má»›i AI gá»£i Ã½
    status VARCHAR(20) DEFAULT 'submitted' CHECK (status IN ('submitted','graded','reviewed')),
    created_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_ws_user ON writing_submissions(user_id);
CREATE INDEX idx_ws_exercise ON writing_submissions(exercise_id);
CREATE INDEX idx_ws_created ON writing_submissions(user_id, created_at);

-- 3. Writing Streaks
CREATE TABLE writing_streaks (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL UNIQUE REFERENCES users(id) ON DELETE CASCADE,
    current_streak INT DEFAULT 0,
    longest_streak INT DEFAULT 0,
    last_writing_date DATE,
    streak_freezes_used INT DEFAULT 0,
    total_writings INT DEFAULT 0,
    total_words_written INT DEFAULT 0,
    avg_score DECIMAL(5,2) DEFAULT 0,
    badges JSONB DEFAULT '[]',     -- ["week_warrior", "monthly_master"]
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 4. User Vocabulary (Sá»• tá»« vá»±ng)
CREATE TABLE user_vocabulary (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    word VARCHAR(100) NOT NULL,
    definition TEXT,
    example_sentence TEXT,
    source VARCHAR(50),            -- 'writing_feedback', 'manual', 'quiz'
    source_id INT,                 -- ID bÃ i viáº¿t nguá»“n
    level VARCHAR(2),              -- CEFR level cá»§a tá»«
    mastery INT DEFAULT 0,         -- 0-5 (SRS level)
    next_review_at TIMESTAMPTZ,    -- Láº§n Ã´n tiáº¿p theo
    review_count INT DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id, word)
);
CREATE INDEX idx_uv_user ON user_vocabulary(user_id);
CREATE INDEX idx_uv_review ON user_vocabulary(user_id, next_review_at);
```

---

## ğŸ—ï¸ Kiáº¿n TrÃºc Backend

```
backend/src/modules/writing/
â”œâ”€â”€ writing.controller.js     # API endpoints
â”œâ”€â”€ writing.service.js        # Business logic + AI grading
â”œâ”€â”€ writing.repository.js     # Database queries
â”œâ”€â”€ writing.routes.js         # Route definitions
â”œâ”€â”€ writing.prompts.js        # AI prompt templates cho tá»«ng level
â””â”€â”€ writing.seed.js           # Seed data cho exercises
```

**API Endpoints:**

| Method | Endpoint | MÃ´ Táº£ |
|--------|----------|--------|
| GET | `/api/writing/exercises?level=B1` | Láº¥y danh sÃ¡ch Ä‘á» bÃ i |
| GET | `/api/writing/exercises/:id` | Chi tiáº¿t Ä‘á» bÃ i |
| POST | `/api/writing/submit` | Ná»™p bÃ i â†’ AI cháº¥m |
| GET | `/api/writing/submissions` | Lá»‹ch sá»­ bÃ i viáº¿t |
| GET | `/api/writing/streak` | ThÃ´ng tin streak |
| POST | `/api/writing/streak/freeze` | DÃ¹ng streak freeze |
| GET | `/api/writing/vocabulary` | Danh sÃ¡ch tá»« vá»±ng |
| POST | `/api/writing/vocabulary` | ThÃªm tá»« thá»§ cÃ´ng |
| GET | `/api/writing/vocabulary/review` | Tá»« cáº§n Ã´n táº­p hÃ´m nay |
| PUT | `/api/writing/vocabulary/:id/review` | Cáº­p nháº­t káº¿t quáº£ Ã´n |
| GET | `/api/writing/stats` | Thá»‘ng kÃª tiáº¿n bá»™ |

---

## ğŸ¨ Frontend Structure

```
frontend/src/features/writing/
â”œâ”€â”€ WritingTab.js              # Tab chÃ­nh
â”œâ”€â”€ ExerciseList.js            # Danh sÃ¡ch Ä‘á» bÃ i theo level
â”œâ”€â”€ WritingEditor.js           # Text editor + word count
â”œâ”€â”€ FeedbackPanel.js           # Hiá»ƒn thá»‹ AI feedback
â”œâ”€â”€ StreakWidget.js             # Widget streak + badges
â”œâ”€â”€ VocabularyList.js           # Sá»• tá»« vá»±ng
â”œâ”€â”€ VocabularyReview.js         # Flashcard Ã´n táº­p
â”œâ”€â”€ ProgressDashboard.js        # Biá»ƒu Ä‘á»“ tiáº¿n bá»™
â””â”€â”€ components/
    â”œâ”€â”€ LevelSelector.js        # Chá»n level CEFR
    â”œâ”€â”€ ScoreRadar.js           # Radar chart 4 tiÃªu chÃ­
    â”œâ”€â”€ StreakCalendar.js        # Calendar heatmap
    â””â”€â”€ ErrorHighlight.js       # Highlight lá»—i trong bÃ i
```

---

## ğŸ“ Implementation Workflow (5 Phases)

### Phase 1: Database & Backend Core (3-4 ngÃ y)
- [ ] Táº¡o migration SQL (4 tables)
- [ ] Táº¡o `writing` module (controller, service, repository, routes)
- [ ] Seed 20-30 Ä‘á» bÃ i máº«u (má»—i level 4-5 Ä‘á»)
- [ ] API: CRUD exercises, submit, get submissions

### Phase 2: AI Grading Engine (3-4 ngÃ y)
- [ ] Thiáº¿t káº¿ prompt templates cho tá»«ng level
- [ ] Implement `gradeWriting()` service (gá»i OpenAI GPT-4o)
- [ ] Parse AI response â†’ scores + errors + suggestions + new words
- [ ] API: POST `/submit` â†’ tráº£ vá» feedback real-time (hoáº·c SSE)

### Phase 3: Streak & Vocabulary (2-3 ngÃ y)
- [ ] Implement streak logic (tÃ­nh streak, freeze, recovery)
- [ ] Implement vocabulary CRUD + auto-collect tá»« feedback
- [ ] SRS algorithm (SM-2) cho vocabulary review
- [ ] APIs cho streak + vocabulary

### Phase 4: Frontend UI (5-7 ngÃ y)
- [ ] `WritingTab` - Layout chÃ­nh vá»›i navigation
- [ ] `ExerciseList` + `LevelSelector` - Chá»n bÃ i theo level
- [ ] `WritingEditor` - Text area + toolbar + word counter
- [ ] `FeedbackPanel` - Hiá»ƒn thá»‹ Ä‘iá»ƒm + lá»—i + gá»£i Ã½
- [ ] `StreakWidget` - Hiá»‡n streak + badges + calendar
- [ ] `VocabularyList` + `VocabularyReview` - Sá»• tá»« + flashcard
- [ ] `ProgressDashboard` - Charts thá»‘ng kÃª

### Phase 5: Polish & Integration (2-3 ngÃ y)
- [ ] TÃ­ch há»£p tab vÃ o `App.js` (thÃªm route/navigation)
- [ ] Responsive design cho mobile
- [ ] TÃ­ch há»£p vá»›i Wallet (Premium features)
- [ ] TÃ­ch há»£p vá»›i Subscription (giá»›i háº¡n Free vs Pro)
- [ ] Testing end-to-end

---

## â±ï¸ Timeline Tá»•ng

| Phase | CÃ´ng Viá»‡c | Thá»i Gian | TÃ­ch LÅ©y |
|-------|-----------|-----------|----------|
| 1 | Database & Backend | 3-4 ngÃ y | ~4 ngÃ y |
| 2 | AI Grading | 3-4 ngÃ y | ~8 ngÃ y |
| 3 | Streak & Vocab | 2-3 ngÃ y | ~11 ngÃ y |
| 4 | Frontend UI | 5-7 ngÃ y | ~18 ngÃ y |
| 5 | Polish | 2-3 ngÃ y | **~20 ngÃ y** |

**Tá»•ng Æ°á»›c tÃ­nh: ~3-4 tuáº§n**

---

## ğŸ”— TÃ­ch Há»£p Vá»›i Há»‡ Thá»‘ng Hiá»‡n CÃ³

| Há»‡ thá»‘ng | CÃ¡ch tÃ­ch há»£p |
|-----------|---------------|
| **Auth** | YÃªu cáº§u Ä‘Äƒng nháº­p, dÃ¹ng `req.user.id` |
| **Subscription** | Free: 3 bÃ i/ngÃ y, Pro: unlimited |
| **Wallet/XP** | HoÃ n thÃ nh bÃ i â†’ +XP, streak milestone â†’ +coins |
| **Chat** | Link "Practice Writing" tá»« chat suggestions |
| **Usage** | Track writing usage trong `user_usage` |

---

## ğŸ’¡ TÃ­nh NÄƒng Má»Ÿ Rá»™ng (TÆ°Æ¡ng Lai)

- ğŸ¤ **Peer Review**: User cháº¥m bÃ i cho nhau
- ğŸ“Š **Writing Analytics**: PhÃ¢n tÃ­ch xu hÆ°á»›ng lá»—i theo thá»i gian  
- ğŸ¯ **IELTS/TOEFL Mode**: BÃ i táº­p theo format thi tháº­t
- ğŸ† **Leaderboard**: Xáº¿p háº¡ng theo Ä‘iá»ƒm trung bÃ¬nh
- ğŸ“± **Push Notification**: Nháº¯c viáº¿t hÃ ng ngÃ y Ä‘á»ƒ giá»¯ streak

---

> **BÆ°á»›c tiáº¿p theo:** Chá»n Phase Ä‘á»ƒ báº¯t Ä‘áº§u implement. Khuyáº¿n nghá»‹ báº¯t Ä‘áº§u tá»« **Phase 1** (Database + Backend).
